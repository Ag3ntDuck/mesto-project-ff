(()=>{"use strict";function e(e,t,o,n,r,c,a,i,u){var l=e.cloneNode(!0).children[0];l.dataset.id=t;var s=l.querySelector(".card__image"),d=l.querySelector(".card__like-button");s.src=n,s.alt=o,l.querySelector(".card__title").innerText=o;var p=l.querySelector(".card__delete-button");return l.querySelector(".card__like-count").textContent=r,a?p.addEventListener("click",a):p.remove(),c&&d.classList.add("card__like-button_is-active"),d.addEventListener("click",i),s.addEventListener("click",u),l}function t(e){"Escape"===e.key&&r(document.querySelector(".popup_is-opened"))}function o(e){e.target===e.currentTarget&&r(e.currentTarget)}function n(e){e.classList.add("popup_is-opened"),window.addEventListener("keydown",t),e.addEventListener("click",o)}function r(e){e.classList.remove("popup_is-opened"),e.removeEventListener("click",o),window.removeEventListener("keydown",t)}var c=function(e,t){i(e,t),Array.from(t.querySelectorAll(e.inputSelector)).forEach((function(o){o.value="",a(e,t,o)}))},a=function(e,t,o){var n=t.querySelector(".".concat(o.id,"-error"));o.classList.remove(e.inputErrorClass),n.classList.remove(e.errorClass),n.textContent=""},i=function(e,t){t.querySelector(e.submitButtonSelector).setAttribute("disabled","")},u=function(e,t){t.querySelector(e.submitButtonSelector).removeAttribute("disabled","")},l={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},s={authorizationHeader:"19f866a5-5150-48f0-9090-e0700a6bf9a7",cohort:"wff-cohort-3",baseUrl:"https://nomoreparties.co/v1"},d=document.querySelector("#card-template").content,p=document.querySelector(".places__list"),_=document.querySelector(".popup_type_image"),f=_.querySelector(".popup__close"),v=_.querySelector(".popup__image"),h=_.querySelector(".popup__caption"),m=function(e){e.innerText="Сохранение..."},y=function(e){e.innerText="Сохранить"};function S(e){var t=e.target,o=t.src,r=t.alt;v.src=o,v.alt=r,h.textContent=r,n(_)}f.addEventListener("click",(function(){r(_)}));var q=document.querySelector(".popup_type_edit"),b=q.querySelector(".popup__input_type_name"),k=q.querySelector(".popup__input_type_description"),E=document.querySelector(".profile__title"),g=document.querySelector(".profile__description"),L=document.querySelector(".profile__image"),C=document.querySelector(".profile__info"),j=function(e){return C.dataset.id};function z(e){var t=e.target.parentElement.dataset.id;!function(t,o,n){fetch("".concat(t.baseUrl,"/").concat(t.cohort,"/cards/").concat(o),{method:"DELETE",headers:{authorization:t.authorizationHeader}}).then((function(){(function(e){e.target.parentElement.remove()})(e)}))}(s,t)}function x(e){var t=e.target.parentElement.parentElement.parentElement,o=t.dataset.id,n=e.target;n.classList.contains("card__like-button_is-active")?function(e,o,r){fetch("".concat(e.baseUrl,"/").concat(e.cohort,"/cards/likes/").concat(o),{method:"DELETE",headers:{authorization:e.authorizationHeader}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return o=e,n.classList.remove("card__like-button_is-active"),void(t.querySelector(".card__like-count").textContent=o.likes.length);var o})).catch((function(e){console.log(e)}))}(s,o):function(e,o,r){fetch("".concat(e.baseUrl,"/").concat(e.cohort,"/cards/likes/").concat(o),{method:"PUT",headers:{authorization:e.authorizationHeader}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return o=e,n.classList.add("card__like-button_is-active"),void(t.querySelector(".card__like-count").textContent=o.likes.length);var o})).catch((function(e){console.log(e)}))}(s,o)}document.querySelector(".profile__edit-button").addEventListener("click",(function(){c(l,q),y(q.querySelector(l.submitButtonSelector)),u(l,q),b.value=E.textContent,k.value=g.textContent,n(q)})),q.querySelector(".popup__close").addEventListener("click",(function(){r(q)}));var A=document.querySelector(".popup_type_new-card"),H=document.querySelector(".profile__add-button"),P=A.querySelector(".popup__form"),T=A.querySelector(".popup__input_type_card-name"),U=A.querySelector(".popup__input_type_url");H.addEventListener("click",(function(){c(l,A),y(A.querySelector(l.submitButtonSelector)),n(A)})),A.querySelector(".popup__close").addEventListener("click",(function(){r(A)})),P.addEventListener("submit",(function(t){t.preventDefault(),r(A),m(A.querySelector(".popup__button"));var o=T.value,n=U.value;!function(t,o,n,r){fetch("".concat(t.baseUrl,"/").concat(t.cohort,"/cards"),{method:"POST",headers:{authorization:t.authorizationHeader,"content-type":"application/json"},body:JSON.stringify({name:o,link:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(t){return o=t,void p.prepend(e(d,o._id,o.name,o.link,o.likes.length,!!o.likes.find((function(e){return e._id===j()})),z,x,S));var o})).catch((function(e){console.log(e)}))}(s,o,n)}));var w,B,D=q.querySelector(".popup__form");D.addEventListener("submit",(function(e){e.preventDefault();var t,o,n,c,a=b.value,i=k.value;m(D.querySelector(".popup__button")),t=s,o=a,n=i,c=function(e){E.textContent=e.name,g.textContent=e.about,L.style.backgroundImage="url(".concat(e.avatar,")"),r(q)},fetch("".concat(t.baseUrl,"/").concat(t.cohort,"/users/me"),{method:"PATCH",headers:{authorization:t.authorizationHeader,"content-type":"application/json"},body:JSON.stringify({name:o,about:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return c(e)})).catch((function(e){console.log(e)}))})),w=s,B=function(t){var o,n,r;E.textContent=t.name,g.textContent=t.about,L.style.backgroundImage="url(".concat(t.avatar,")"),o=t._id,C.dataset.id=o,n=s,r=function(t){t.forEach((function(t){p.appendChild(e(d,t._id,t.name,t.link,t.likes.length,!!t.likes.find((function(e){return e._id===j()})),j()===t.owner._id?z:void 0,x,S))}))},fetch("".concat(n.baseUrl,"/").concat(n.cohort,"/cards"),{headers:{authorization:n.authorizationHeader}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return r(e)})).catch((function(e){console.log(e)}))},fetch("".concat(w.baseUrl,"/").concat(w.cohort,"/users/me"),{headers:{authorization:w.authorizationHeader}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return B(e)})).catch((function(e){console.log(e)})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){Array.from(t.querySelectorAll(e.inputSelector)).forEach((function(o){o.addEventListener("input",(function(){!function(e,t,o){if(o.validity.patternMismatch?o.setCustomValidity(o.dataset.errorMessage):o.setCustomValidity(""),o.validity.valid){a(e,t,o);for(var n=!0,r=0,c=Array.from(t.querySelectorAll(e.inputSelector));r<c.length;r++)c[r].validity.valid||(n=!1);n?u(e,t):i(e,t)}else!function(e,t,o,n){var r=t.querySelector(".".concat(o.id,"-error"));o.classList.add(e.inputErrorClass),r.textContent=n,r.classList.add(e.errorClass)}(e,t,o,o.validationMessage),i(e,t)}(e,t,o)}))}))}(e,t)}))}(l);var N=document.querySelector(".popup_type_edit_avatar"),O=document.querySelector(".profile_edit"),I=N.querySelector(".popup__input_type_avatar");O.addEventListener("click",(function(){c(l,N),y(N.querySelector(l.submitButtonSelector)),n(N)})),N.querySelector(".popup__close").addEventListener("click",(function(){r(N)}));var J=N.querySelector(".popup__form");J.addEventListener("submit",(function(e){e.preventDefault();var t=I.value;m(J.querySelector(".popup__button")),function(e,t,o){fetch("".concat(e.baseUrl,"/").concat(e.cohort,"/users/me/avatar"),{method:"PATCH",headers:{authorization:e.authorizationHeader,"content-type":"application/json"},body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return t=e,L.style.backgroundImage="url(".concat(t.avatar,")"),void r(N);var t})).catch((function(e){console.log(e)}))}(s,t)}))})();