(()=>{"use strict";function e(e,t,o,n,r,c,a,i,u){var l=e.cloneNode(!0).children[0];l.dataset.id=t;var s=l.querySelector(".card__image"),d=l.querySelector(".card__like-button");s.src=n,s.alt=o,l.querySelector(".card__title").innerText=o;var p=l.querySelector(".card__delete-button");return l.querySelector(".card__like-count").textContent=r,a?p.addEventListener("click",a):p.remove(),c&&d.classList.add("card__like-button_is-active"),d.addEventListener("click",i),s.addEventListener("click",u),l}function t(e){"Escape"===e.key&&r(document.querySelector(".popup_is-opened"))}function o(e){e.target===e.currentTarget&&r(e.currentTarget)}function n(e){e.classList.add("popup_is-opened"),window.addEventListener("keydown",t),e.addEventListener("click",o)}function r(e){e.classList.remove("popup_is-opened"),e.removeEventListener("click",o),window.removeEventListener("keydown",t)}var c=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},a=function(e,t){u(e,t),Array.from(t.querySelectorAll(e.inputSelector)).forEach((function(o){o.value="",i(e,t,o)}))},i=function(e,t,o){var n=t.querySelector(".".concat(o.id,"-error"));o.classList.remove(e.inputErrorClass),n.classList.remove(e.errorClass),n.textContent=""},u=function(e,t){t.querySelector(e.submitButtonSelector).setAttribute("disabled","")},l=function(e,t){t.querySelector(e.submitButtonSelector).removeAttribute("disabled","")},s={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},d={authorizationHeader:"19f866a5-5150-48f0-9090-e0700a6bf9a7",cohort:"wff-cohort-3",baseUrl:"https://nomoreparties.co/v1"},p=document.querySelector("#card-template").content,_=document.querySelector(".places__list"),f=document.querySelector(".popup_type_image"),h=f.querySelector(".popup__close"),y=f.querySelector(".popup__image"),m=f.querySelector(".popup__caption"),v=function(e){e.innerText="Сохранение..."},S=function(e){e.innerText="Сохранить"};function q(e){var t=e.target,o=t.src,r=t.alt;y.src=o,y.alt=r,m.textContent=r,n(f)}h.addEventListener("click",(function(){r(f)}));var b=document.querySelector(".popup_type_edit"),k=b.querySelector(".popup__input_type_name"),E=b.querySelector(".popup__input_type_description"),g=document.querySelector(".profile__title"),L=document.querySelector(".profile__description"),C=document.querySelector(".profile__image"),z=document.querySelector(".profile__info"),x=function(e){return z.dataset.id};function A(e){var t=e.target.parentElement.dataset.id;(function(e,t){return fetch("".concat(e.baseUrl,"/").concat(e.cohort,"/cards/").concat(t),{method:"DELETE",headers:{authorization:e.authorizationHeader}}).then(c)})(d,t).then((function(){!function(e){e.target.parentElement.remove()}(e)})).catch((function(e){console.log(e)}))}function H(e){var t=e.target.parentElement.parentElement.parentElement,o=t.dataset.id,n=e.target;n.classList.contains("card__like-button_is-active")?function(e,t){return fetch("".concat(e.baseUrl,"/").concat(e.cohort,"/cards/likes/").concat(t),{method:"DELETE",headers:{authorization:e.authorizationHeader}}).then(c)}(d,o).then((function(e){n.classList.remove("card__like-button_is-active"),t.querySelector(".card__like-count").textContent=e.likes.length})).catch((function(e){console.log(e)})):function(e,t){return fetch("".concat(e.baseUrl,"/").concat(e.cohort,"/cards/likes/").concat(t),{method:"PUT",headers:{authorization:e.authorizationHeader}}).then(c)}(d,o).then((function(e){n.classList.add("card__like-button_is-active"),t.querySelector(".card__like-count").textContent=e.likes.length})).catch((function(e){console.log(e)}))}document.querySelector(".profile__edit-button").addEventListener("click",(function(){a(s,b),S(b.querySelector(s.submitButtonSelector)),l(s,b),k.value=g.textContent,E.value=L.textContent,n(b)})),b.querySelector(".popup__close").addEventListener("click",(function(){r(b)}));var T=document.querySelector(".popup_type_new-card"),U=document.querySelector(".profile__add-button"),w=T.querySelector(".popup__form"),B=T.querySelector(".popup__input_type_card-name"),j=T.querySelector(".popup__input_type_url");U.addEventListener("click",(function(){a(s,T),S(T.querySelector(s.submitButtonSelector)),n(T)})),T.querySelector(".popup__close").addEventListener("click",(function(){r(T)})),w.addEventListener("submit",(function(t){t.preventDefault(),v(T.querySelector(".popup__button"));var o=B.value,n=j.value;(function(e,t,o){return fetch("".concat(e.baseUrl,"/").concat(e.cohort,"/cards"),{method:"POST",headers:{authorization:e.authorizationHeader,"content-type":"application/json"},body:JSON.stringify({name:t,link:o})}).then(c)})(d,o,n).then((function(t){r(T),_.prepend(e(p,t._id,t.name,t.link,t.likes.length,!!t.likes.find((function(e){return e._id===x()})),A,H,q))})).catch((function(e){console.log(e)}))}));var D,P=b.querySelector(".popup__form");P.addEventListener("submit",(function(e){e.preventDefault();var t,o,n,a=k.value,i=E.value;v(P.querySelector(".popup__button")),(t=d,o=a,n=i,fetch("".concat(t.baseUrl,"/").concat(t.cohort,"/users/me"),{method:"PATCH",headers:{authorization:t.authorizationHeader,"content-type":"application/json"},body:JSON.stringify({name:o,about:n})}).then(c)).then((function(e){g.textContent=e.name,L.textContent=e.about,C.style.backgroundImage="url(".concat(e.avatar,")"),r(b)})).catch((function(e){console.log(e)}))})),(D=d,fetch("".concat(D.baseUrl,"/").concat(D.cohort,"/users/me"),{headers:{authorization:D.authorizationHeader}}).then(c)).then((function(t){var o;g.textContent=t.name,L.textContent=t.about,C.style.backgroundImage="url(".concat(t.avatar,")"),o=t._id,z.dataset.id=o,function(e){return fetch("".concat(e.baseUrl,"/").concat(e.cohort,"/cards"),{headers:{authorization:e.authorizationHeader}}).then(c)}(d).then((function(t){t.forEach((function(t){_.appendChild(e(p,t._id,t.name,t.link,t.likes.length,!!t.likes.find((function(e){return e._id===x()})),x()===t.owner._id?A:void 0,H,q))}))})).catch((function(e){console.log(e)}))})).catch((function(e){console.log(e)})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){Array.from(t.querySelectorAll(e.inputSelector)).forEach((function(o){o.addEventListener("input",(function(){!function(e,t,o){if(o.validity.patternMismatch?o.setCustomValidity(o.dataset.errorMessage):o.setCustomValidity(""),o.validity.valid){i(e,t,o);for(var n=!0,r=0,c=Array.from(t.querySelectorAll(e.inputSelector));r<c.length;r++)c[r].validity.valid||(n=!1);n?l(e,t):u(e,t)}else!function(e,t,o,n){var r=t.querySelector(".".concat(o.id,"-error"));o.classList.add(e.inputErrorClass),r.textContent=n,r.classList.add(e.errorClass)}(e,t,o,o.validationMessage),u(e,t)}(e,t,o)}))}))}(e,t)}))}(s);var N=document.querySelector(".popup_type_edit_avatar"),O=document.querySelector(".profile_edit"),I=N.querySelector(".popup__input_type_avatar");O.addEventListener("click",(function(){a(s,N),S(N.querySelector(s.submitButtonSelector)),n(N)})),N.querySelector(".popup__close").addEventListener("click",(function(){r(N)}));var J=N.querySelector(".popup__form");J.addEventListener("submit",(function(e){e.preventDefault();var t=I.value;v(J.querySelector(".popup__button")),function(e,t){return fetch("".concat(e.baseUrl,"/").concat(e.cohort,"/users/me/avatar"),{method:"PATCH",headers:{authorization:e.authorizationHeader,"content-type":"application/json"},body:JSON.stringify({avatar:t})}).then(c)}(d,t).then((function(e){C.style.backgroundImage="url(".concat(e.avatar,")"),r(N)})).catch((function(e){console.log(e)}))}))})();